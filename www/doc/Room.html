<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Room
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!Room.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">Room</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Room
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></li>
          
            <li class="next">Room</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Agis</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">app/models/room.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="STATE_DRAFT-constant" class="">STATE_DRAFT =
          <div class="docstring">
  <div class="discussion">
    
<p>draft –unused</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0</span></pre></dd>
      
        <dt id="STATE_PUBLIC-constant" class="">STATE_PUBLIC =
          <div class="docstring">
  <div class="discussion">
    
<p>waiting for players in browser</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
        <dt id="STATE_LOCKED-constant" class="">STATE_LOCKED =
          <div class="docstring">
  <div class="discussion">
    
<p>everybody is ready, waiting for server</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>2</span></pre></dd>
      
        <dt id="STATE_ACTIVE-constant" class="">STATE_ACTIVE =
          <div class="docstring">
  <div class="discussion">
    
<p>game is being played</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="STATE_OVER-constant" class="">STATE_OVER =
          <div class="docstring">
  <div class="discussion">
    
<p>game is done</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>8</span></pre></dd>
      
        <dt id="STATE_FAILED-constant" class="">STATE_FAILED =
          <div class="docstring">
  <div class="discussion">
    
<p>game has failed for whatever reason</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>16</span></pre></dd>
      
        <dt id="SPREAD_VERTICAL-constant" class="">SPREAD_VERTICAL =
          <div class="docstring">
  <div class="discussion">
    
<p>best team wins</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1</span></pre></dd>
      
        <dt id="SPREAD_HORIZONTAL-constant" class="">SPREAD_HORIZONTAL =
          <div class="docstring">
  <div class="discussion">
    
<p>best 50% wins</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>2</span></pre></dd>
      
        <dt id="PLAYERS_FOUR-constant" class="">PLAYERS_FOUR =
          
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="PLAYERS_EIGHT-constant" class="">PLAYERS_EIGHT =
          
        </dt>
        <dd><pre class="code"><span class='int'>8</span></pre></dd>
      
        <dt id="PLAYERS_SIXTEEN-constant" class="">PLAYERS_SIXTEEN =
          
        </dt>
        <dd><pre class="code"><span class='int'>16</span></pre></dd>
      
        <dt id="PLAYERS_THIRTYTWO-constant" class="">PLAYERS_THIRTYTWO =
          
        </dt>
        <dd><pre class="code"><span class='int'>32</span></pre></dd>
      
        <dt id="ODDS_HALF-constant" class="">ODDS_HALF =
          <div class="docstring">
  <div class="discussion">
    
<p>best 50% win, min 2 players</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>2</span></pre></dd>
      
        <dt id="ODDS_QUARTER-constant" class="">ODDS_QUARTER =
          <div class="docstring">
  <div class="discussion">
    
<p>best 25% win, min 4 players</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="ODDS_EIGHTH-constant" class="">ODDS_EIGHTH =
          <div class="docstring">
  <div class="discussion">
    
<p>best 1/8 win, min 8 players</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>8</span></pre></dd>
      
        <dt id="ODDS_SIXTEENTH-constant" class="">ODDS_SIXTEENTH =
          <div class="docstring">
  <div class="discussion">
    
<p>best 1/16 win, min 16 players</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>16</span></pre></dd>
      
        <dt id="ODDS_SINGLE-constant" class="">ODDS_SINGLE =
          <div class="docstring">
  <div class="discussion">
    
<p>best 1/32 (up to 1 player) wins, min 32 players</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>32</span></pre></dd>
      
        <dt id="WAGER_MIN-constant" class="">WAGER_MIN =
          
        </dt>
        <dd><pre class="code"><span class='int'>5</span></pre></dd>
      
        <dt id="WAGER_MAX-constant" class="">WAGER_MAX =
          
        </dt>
        <dd><pre class="code"><span class='int'>50</span></pre></dd>
      
        <dt id="ROOM_TIMEOUT-constant" class="">ROOM_TIMEOUT =
          
        </dt>
        <dd><pre class="code"><span class='int'>30</span><span class='period'>.</span><span class='id identifier rubyid_seconds'>seconds</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#game-instance_method" title="#game (instance method)">- (Object) <strong>game</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute game.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#map-instance_method" title="#map (instance method)">- (Object) <strong>map</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute map.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#playercount-instance_method" title="#playercount (instance method)">- (Object) <strong>playercount</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute playercount.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server-instance_method" title="#server (instance method)">- (Object) <strong>server</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#spread-instance_method" title="#spread (instance method)">- (Object) <strong>spread</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute spread.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#spreadmode-instance_method" title="#spreadmode (instance method)">- (Object) <strong>spreadmode</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute spreadmode.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#wager-instance_method" title="#wager (instance method)">- (Object) <strong>wager</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute wager.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_remove_player%21-instance_method" title="#_remove_player! (instance method)">- (Object) <strong>_remove_player!</strong>(player_id, mrules) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes the player from the given mrules if the room is public.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aamend_player-instance_method" title="#aamend_player (instance method)">- (Object) <strong>aamend_player</strong>(player_id, hash) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aappend_chatmessage-instance_method" title="#aappend_chatmessage (instance method)">- (Object) <strong>aappend_chatmessage</strong>(player_id, msg) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amend_player%21-instance_method" title="#amend_player! (instance method)">- (Object) <strong>amend_player!</strong>(player, hash) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Amend the given player&#39;s standing in the Room&#39;s ruleset.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#amend_player_hash-instance_method" title="#amend_player_hash (instance method)">- (Hash) <strong>amend_player_hash</strong>(mrules, player, hash) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Modifies a player&#39;s hash in a ruleset.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append_chatmessage%21-instance_method" title="#append_chatmessage! (instance method)">- (Object) <strong>append_chatmessage!</strong>(player, message) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Append a chat message associated with a user to the Room&#39;s chatbox.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append_player%21-instance_method" title="#append_player! (instance method)">- (Object) <strong>append_player!</strong>(player) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add the player to the Room&#39;s ruleset.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append_player_hash-instance_method" title="#append_player_hash (instance method)">- (Hash) <strong>append_player_hash</strong>(mrules, player_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds the player by ID to the given srules.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aremove_player-instance_method" title="#aremove_player (instance method)">- (Object) <strong>aremove_player</strong>(player_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_ready-instance_method" title="#check_ready (instance method)">- (Hash) <strong>check_ready</strong>(ruleset) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Locks the room and saves it in ActiveRecord if 1) the room is full 2)
everyone is ready</p>

<pre class="code ruby"><code class="ruby">This method writes to ActiveRecord.</code></pre>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_wager-instance_method" title="#check_wager (instance method)">- (Hash) <strong>check_wager</strong>(mrules) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the new wager for mrules.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dump_timeout_players-instance_method" title="#dump_timeout_players (instance method)">- (Hash) <strong>dump_timeout_players</strong>(mrules) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove all players who are over their timeout.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_player-instance_method" title="#fetch_player (instance method)">- (Integer) <strong>fetch_player</strong>(pid, mrules) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find the players array index of a player in the given ruleset.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_alive%3F-instance_method" title="#is_alive? (instance method)">- (Boolean) <strong>is_alive?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Check if the is_alive key is set for this room in Redis.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_public%3F-instance_method" title="#is_public? (instance method)">- (Boolean) <strong>is_public?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Whether or not the room state is 1 (STATE_PUBLIC).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#map_in_maplist-instance_method" title="#map_in_maplist (instance method)">- (Object) <strong>map_in_maplist</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rapidkey-instance_method" title="#rapidkey (instance method)">- (Object) <strong>rapidkey</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_player%21-instance_method" title="#remove_player! (instance method)">- (Object) <strong>remove_player!</strong>(player) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Remove the given player from the Room&#39;s ruleset Doesn&#39;t care if the
player is already removed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#removenoticemsg-instance_method" title="#removenoticemsg (instance method)">- (Hash) <strong>removenoticemsg</strong>(mrules, player_id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a remove notice to the given srules&#39; chatbox.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rstate-instance_method" title="#rstate (instance method)">- (Integer) <strong>rstate</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>STATE_DRAFT   = 0  draft –unused STATE_PUBLIC  = 1  waiting for players in
browser STATE_LOCKED  = 2  everybody is ready, waiting for server
STATE_ACTIVE  = 4  game is being played STATE_OVER    = 8  game is done
STATE_FAILED  = 16 game has failed for whatever reason.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rstate%3D-instance_method" title="#rstate= (instance method)">- (Object) <strong>rstate=</strong>(a) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#srules-instance_method" title="#srules (instance method)">- (Object) <strong>srules</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Hash containing the ruleset for this room, includes all central data except
state (see rstate).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#srules%3D-instance_method" title="#srules= (instance method)">- (Object) <strong>srules=</strong>(a) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_xhr-instance_method" title="#update_xhr (instance method)">- (Object) <strong>update_xhr</strong>(cuser, params) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>XHR direct line to amending a player.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">ActiveRecord::Base</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ActiveRecord/Base.html#reset_subclasses-class_method" title="ActiveRecord::Base.reset_subclasses (method)">reset_subclasses</a></span></p>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="game=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="game-instance_method">
  
    - (<tt>Object</tt>) <strong>game</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute game</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_game'>game</span>
  <span class='ivar'>@game</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="map=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="map-instance_method">
  
    - (<tt>Object</tt>) <strong>map</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute map</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_map'>map</span>
  <span class='ivar'>@map</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="playercount=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="playercount-instance_method">
  
    - (<tt>Object</tt>) <strong>playercount</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute playercount</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_playercount'>playercount</span>
  <span class='ivar'>@playercount</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="server=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="server-instance_method">
  
    - (<tt>Object</tt>) <strong>server</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server'>server</span>
  <span class='ivar'>@server</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="spread=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="spread-instance_method">
  
    - (<tt>Object</tt>) <strong>spread</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute spread</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_spread'>spread</span>
  <span class='ivar'>@spread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="spreadmode=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="spreadmode-instance_method">
  
    - (<tt>Object</tt>) <strong>spreadmode</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute spreadmode</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_spreadmode'>spreadmode</span>
  <span class='ivar'>@spreadmode</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="wager=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="wager-instance_method">
  
    - (<tt>Object</tt>) <strong>wager</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute wager</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wager'>wager</span>
  <span class='ivar'>@wager</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_remove_player!-instance_method">
  
    - (<tt>Object</tt>) <strong>_remove_player!</strong>(player_id, mrules) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes the player from the given mrules if the room is public</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>player_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of the given player&#39;s User</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid__remove_player!'>_remove_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pi'>pi</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_player'>fetch_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_pi'>pi</span> <span class='kw'>and</span>
     <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_public?'>is_public?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_pi'>pi</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aamend_player-instance_method">
  
    - (<tt>Object</tt>) <strong>aamend_player</strong>(player_id, hash) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aamend_player'>aamend_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_srules'>srules</span>
  <span class='id identifier rubyid_player'>player</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_public?'>is_public?</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>playercount</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_reserve_room!'>reserve_room!</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid__remove_player!'>_remove_player!</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_srules'>srules</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='const'>ROOM_TIMEOUT</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_amend_player_hash'>amend_player_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_check_ready'>check_ready</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_srules'>srules</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aappend_chatmessage-instance_method">
  
    - (<tt>Object</tt>) <strong>aappend_chatmessage</strong>(player_id, msg) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297
298
299
300
301</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 295</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aappend_chatmessage'>aappend_chatmessage</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_srules'>srules</span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addendum</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>40</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_srules'>srules</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="amend_player!-instance_method">
  
    - (<tt>Object</tt>) <strong>amend_player!</strong>(player, hash) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Amend the given player&#39;s standing in the Room&#39;s ruleset</p>

<p>This method writes to Redis and possibly to ActiveRecord</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>player</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveRecord instance of the player</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hash</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>set of changes to user in Room</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 275</span>

<span class='kw'>def</span> <span class='id identifier rubyid_amend_player!'>amend_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_acall'>acall</span><span class='lparen'>(</span><span class='gvar'>$redis</span><span class='comma'>,</span> <span class='symbol'>:aamend_player</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span> <span class='kw'>or</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="amend_player_hash-instance_method">
  
    - (<tt>Hash</tt>) <strong>amend_player_hash</strong>(mrules, player, hash) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Modifies a player&#39;s hash in a ruleset</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>player</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveModel instance of the given player</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hash</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the given modifications to the user</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218
219
220
221
222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 215</span>

<span class='kw'>def</span> <span class='id identifier rubyid_amend_player_hash'>amend_player_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_append_player_hash'>append_player_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_pi'>pi</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_player'>fetch_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pi'>pi</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_player'>fetch_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='const'>WAGER_MIN</span> <span class='kw'>and</span>
     <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&lt;=</span> <span class='const'>WAGER_MAX</span> <span class='kw'>and</span>
     <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_total_balance'>total_balance</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_pi'>pi</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_pi'>pi</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append_chatmessage!-instance_method">
  
    - (<tt>Object</tt>) <strong>append_chatmessage!</strong>(player, message) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Append a chat message associated with a user to the Room&#39;s chatbox.
Each message contains an unrelated addendum array for messages about
players entering or leaving the room. The chatroom only persists the last
40 messages</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>player</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveRecord instance of the player</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>string of the user&#39;s message</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 310</span>

<span class='kw'>def</span> <span class='id identifier rubyid_append_chatmessage!'>append_chatmessage!</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_acall'>acall</span><span class='lparen'>(</span><span class='gvar'>$redis</span><span class='comma'>,</span> <span class='id identifier rubyid_aappend_chatmessage'>aappend_chatmessage</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append_player!-instance_method">
  
    - (<tt>Object</tt>) <strong>append_player!</strong>(player) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add the player to the Room&#39;s ruleset. Amend player does the same thing,
use that instead</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>player</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveRecord instance of the player</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_append_player!'>append_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_acall'>acall</span><span class='lparen'>(</span><span class='gvar'>$redis</span><span class='comma'>,</span> <span class='symbol'>:aamend_player</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append_player_hash-instance_method">
  
    - (<tt>Hash</tt>) <strong>append_player_hash</strong>(mrules, player_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds the player by ID to the given srules</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>player_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID of player to add</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_append_player_hash'>append_player_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_player'>player</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ready</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_srules'>srules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>avatar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_steam_avatar_urls'>steam_avatar_urls</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>steamname</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_steam_name'>steam_name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aremove_player-instance_method">
  
    - (<tt>Object</tt>) <strong>aremove_player</strong>(player_id) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aremove_player'>aremove_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_srules'>srules</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid_removenoticemsg'>removenoticemsg</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span> <span class='op'>=</span> <span class='id identifier rubyid__remove_player!'>_remove_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_srules'>srules</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_reservation_is_room?'>reservation_is_room?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unreserve!'>unreserve!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_ready-instance_method">
  
    - (<tt>Hash</tt>) <strong>check_ready</strong>(ruleset) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Locks the room and saves it in ActiveRecord if 1) the room is full 2)
everyone is ready</p>

<p>This method writes to ActiveRecord</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>ruleset</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169
170
171
172
173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 167</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_ready'>check_ready</span><span class='lparen'>(</span><span class='id identifier rubyid_ruleset'>ruleset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruleset'>ruleset</span> <span class='op'>=</span> <span class='id identifier rubyid_dump_timeout_players'>dump_timeout_players</span><span class='lparen'>(</span><span class='id identifier rubyid_ruleset'>ruleset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruleset'>ruleset</span> <span class='op'>=</span> <span class='id identifier rubyid_check_wager'>check_wager</span><span class='lparen'>(</span><span class='id identifier rubyid_ruleset'>ruleset</span><span class='rparen'>)</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_ruleset'>ruleset</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>==</span> <span class='id identifier rubyid_ruleset'>ruleset</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>playercount</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>and</span>
     <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_is_public?'>is_public?</span> <span class='kw'>and</span>
     <span class='id identifier rubyid_ruleset'>ruleset</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_acc'>acc</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_acc'>acc</span> <span class='kw'>and</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ready</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rstate'>rstate</span> <span class='op'>=</span> <span class='const'>STATE_LOCKED</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ruleset'>ruleset</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_wager-instance_method">
  
    - (<tt>Hash</tt>) <strong>check_wager</strong>(mrules) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the new wager for mrules. If the lowest common wager for the room is
greater than the current, it shall be the new shared wager. If the highest
common wager for the room is lower than the current, it shall be the new
shared wager.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_wager'>check_wager</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_wagers'>wagers</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='id identifier rubyid_wagers'>wagers</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_wagers'>wagers</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_min'>min</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id identifier rubyid_min'>min</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_min'>min</span>
  <span class='kw'>elsif</span><span class='lparen'>(</span><span class='id identifier rubyid_max'>max</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id identifier rubyid_max'>max</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_max'>max</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dump_timeout_players-instance_method">
  
    - (<tt>Hash</tt>) <strong>dump_timeout_players</strong>(mrules) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove all players who are over their timeout</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of srules</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135
136
137
138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dump_timeout_players'>dump_timeout_players</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each_index'>each_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='kw'>not</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>id:</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reservation_is_room?'>reservation_is_room?</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_player-instance_method">
  
    - (<tt>Integer</tt>) <strong>fetch_player</strong>(pid, mrules) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find the players array index of a player in the given ruleset</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pid</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the User of this player</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a version of srules</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The position of the player in the given ruleset&#39;s player list</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_player'>fetch_player</span><span class='lparen'>(</span><span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_find_index'>find_index</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='id identifier rubyid_pid'>pid</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_alive?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_alive?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Check if the is_alive key is set for this room in Redis</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_alive?'>is_alive?</span>
  <span class='kw'>true</span> <span class='kw'>if</span> <span class='gvar'>$redis</span><span class='period'>.</span><span class='id identifier rubyid_hget'>hget</span><span class='lparen'>(</span><span class='id identifier rubyid_rapidkey'>rapidkey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is_alive</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_public?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>is_public?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns whether or not the room state is 1 (STATE_PUBLIC)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>whether or not the room state is 1 (STATE_PUBLIC)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_public?'>is_public?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rstate'>rstate</span> <span class='op'>==</span> <span class='const'>STATE_PUBLIC</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="map_in_maplist-instance_method">
  
    - (<tt>Object</tt>) <strong>map_in_maplist</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_map_in_maplist'>map_in_maplist</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_ml'>ml</span> <span class='op'>=</span> <span class='gvar'>$gamerist_mapdata</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>games</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_g'>g</span><span class='op'>|</span> <span class='id identifier rubyid_g'>g</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@game</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_ml'>ml</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>maps</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='ivar'>@map</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='symbol'>:map</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Map is invalid!!!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rapidkey-instance_method">
  
    - (<tt>Object</tt>) <strong>rapidkey</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rapidkey'>rapidkey</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gamerist-room {</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_player!-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_player!</strong>(player) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Remove the given player from the Room&#39;s ruleset Doesn&#39;t care if the
player is already removed</p>

<p>This method writes to Redis</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>player</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveRecord instance of the player</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 284</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_player!'>remove_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_player'>player</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_acall'>acall</span><span class='lparen'>(</span><span class='gvar'>$redis</span><span class='comma'>,</span> <span class='symbol'>:aremove_player</span><span class='comma'>,</span> <span class='id identifier rubyid_player'>player</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="removenoticemsg-instance_method">
  
    - (<tt>Hash</tt>) <strong>removenoticemsg</strong>(mrules, player_id) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a remove notice to the given srules&#39; chatbox</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mrules</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>old version of mrules</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>player_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the given player&#39;s User&#39;s id</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>new version of srules</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


247
248
249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 247</span>

<span class='kw'>def</span> <span class='id identifier rubyid_removenoticemsg'>removenoticemsg</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='comma'>,</span> <span class='id identifier rubyid_player_id'>player_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pi'>pi</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_player'>fetch_player</span><span class='lparen'>(</span><span class='id identifier rubyid_player_id'>player_id</span><span class='comma'>,</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_mrules'>mrules</span> <span class='kw'>unless</span> <span class='id identifier rubyid_pi'>pi</span>
  <span class='id identifier rubyid_add'>add</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>left:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>players</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_pi'>pi</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>steamname</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> has left the room</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TOP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addendum</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_add'>add</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_mrules'>mrules</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>messages</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>addendum</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_add'>add</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mrules'>mrules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rstate-instance_method">
  
    - (<tt>Integer</tt>) <strong>rstate</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>STATE_DRAFT   = 0  draft –unused STATE_PUBLIC  = 1  waiting for players in
browser STATE_LOCKED  = 2  everybody is ready, waiting for server
STATE_ACTIVE  = 4  game is being played STATE_OVER    = 8  game is done
STATE_FAILED  = 16 game has failed for whatever reason</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>number enum of room state</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rstate'>rstate</span>
  <span class='gvar'>$redis</span><span class='period'>.</span><span class='id identifier rubyid_hfetch'>hfetch</span> <span class='id identifier rubyid_rapidkey'>rapidkey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rstate=-instance_method">
  
    - (<tt>Object</tt>) <strong>rstate=</strong>(a) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>a</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>specify a new enum of room state</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 117</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rstate='>rstate=</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>
  <span class='gvar'>$redis</span><span class='period'>.</span><span class='id identifier rubyid_hset'>hset</span> <span class='id identifier rubyid_rapidkey'>rapidkey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>state</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="srules-instance_method">
  
    - (<tt>Object</tt>) <strong>srules</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns hash containing the ruleset for this room, includes all central
data except state (see rstate)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>hash containing the ruleset for this room, includes all central data except
state (see rstate)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_srules'>srules</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='gvar'>$redis</span><span class='period'>.</span><span class='id identifier rubyid_hfetch'>hfetch</span><span class='lparen'>(</span><span class='id identifier rubyid_rapidkey'>rapidkey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rules</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rules'>rules</span>
  <span class='kw'>end</span>
  <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="srules=-instance_method">
  
    - (<tt>Object</tt>) <strong>srules=</strong>(a) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>a</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>hash of rules that will be converted into JSON object</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_srules='>srules=</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rules'>rules</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span>
  <span class='gvar'>$redis</span><span class='period'>.</span><span class='id identifier rubyid_hset'>hset</span> <span class='id identifier rubyid_rapidkey'>rapidkey</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rules</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rules'>rules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_xhr-instance_method">
  
    - (<tt>Object</tt>) <strong>update_xhr</strong>(cuser, params) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>XHR direct line to amending a player. params upclass: readywager (default)
or chatroom</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cuser</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="User.html" title="User (class)">User</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ActiveRecord instance of the player</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>parameters sent through controller PATCH method</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320
321
322
323
324
325
326
327
328</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/room.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_xhr'>update_xhr</span><span class='lparen'>(</span><span class='id identifier rubyid_cuser'>cuser</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upclass</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>readywager</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upclass</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_remove_player!'>remove_player!</span> <span class='id identifier rubyid_cuser'>cuser</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_amend_player!'>amend_player!</span><span class='lparen'>(</span><span class='id identifier rubyid_cuser'>cuser</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wager</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ready</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ready</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upclass</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chatroom</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_append_chatmessage!'>append_chatmessage!</span><span class='lparen'>(</span><span class='id identifier rubyid_cuser'>cuser</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Jun  4 13:16:54 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>